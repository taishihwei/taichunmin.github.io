(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{410:function(e,_,t){"use strict";t.r(_);var o=t(8),v=Object(o.a)({},(function(){var e=this,_=e.$createElement,t=e._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"32-wei-yuan-cheng-shi-shi-yong-reg-qu-du-qu-windows-64-wei-yuan-de-deng-lu-dang-zi-liao"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#32-wei-yuan-cheng-shi-shi-yong-reg-qu-du-qu-windows-64-wei-yuan-de-deng-lu-dang-zi-liao"}},[e._v("#")]),e._v(" 32 位元程式使用 reg 去讀取 Windows 64 位元的登錄檔資料")]),e._v(" "),t("p",[e._v("使用 Dev-C++所編譯出來的程式，都是32位元的")]),e._v(" "),t("p",[e._v("在x64的系統中，有時候會導致讀取不到想要讀取的資料")]),e._v(" "),t("p",[e._v("舉例：")]),e._v(" "),t("p",[e._v("若安裝 64 位元的 JDK，則在 Dev-C++ 讀取不到 Java 的安裝路徑")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('REG QUERY "hklm\\SOFTWARE\\JavaSoft\\Java Development Kit" /v CurrentVersion  (找不到)\n')])])]),t("p",[e._v("這時，請改用以下敘述")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('%windir%\\Sysnative\\REG QUERY "hklm\\SOFTWARE\\JavaSoft\\Java Development Kit" /v CurrentVersion\n')])])]),t("p",[e._v("因為在 x64 系統中執行 32 位元的程式，會自動進入 WOW64 的模式，位於 "),t("code",[e._v("%windir%\\System32")]),e._v(" 的 "),t("code",[e._v("reg.exe")]),e._v(" (64bit) 會被重定向到 "),t("code",[e._v("%windir%\\SysWOW64")]),e._v(" 的 "),t("code",[e._v("reg.exe")]),e._v(" (32bit)")]),e._v(" "),t("p",[e._v("若要在32位元的程式中強制讀取位於 "),t("code",[e._v("%windir%\\System32")]),e._v(" 的 "),t("code",[e._v("reg.exe")]),e._v(" (64bit)，則須改用 "),t("code",[e._v("%windir%\\Sysnative\\")])]),e._v(" "),t("hr"),e._v(" "),t("p",[e._v("參考資料：")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"http://blog.csdn.net/andylin02/article/details/2679792",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://blog.csdn.net/andylin02/article/details/2679792"),t("OutboundLink")],1),e._v(" - "),t("a",{attrs:{href:"http://blog.csdn.net/andylin02/article/details/2679792",target:"_blank",rel:"noopener noreferrer"}},[e._v("重定向"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://blog.xuite.net/y0933717246/IT/39759341",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://blog.xuite.net/y0933717246/IT/39759341"),t("OutboundLink")],1),e._v(" - 補充說明 SysWoW64 目錄")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.cnblogs.com/hsapphire/archive/2011/03/09/1978519.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://www.cnblogs.com/hsapphire/archive/2011/03/09/1978519.html"),t("OutboundLink")],1),e._v(" - 如何通过使用 64 位版本 Windows 查看系统注册表 WOW6432Node")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.tipandtrick.net/2008/how-to-suppress-and-bypass-system32-file-system-redirect-to-syswow64-folder-with-sysnative/zh_TW/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://www.tipandtrick.net/2008/how-to-suppress-and-bypass-system32-file-system-redirect-to-syswow64-folder-with-sysnative/zh_TW/"),t("OutboundLink")],1),e._v(" - 如何制止和繞道system32文件系統重定向到SysWow64文件夾與sysnative")])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"http://www.tipandtrick.net/2008/how-to-suppress-and-bypass-system32-file-system-redirect-to-syswow64-folder-with-sysnative/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://www.tipandtrick.net/2008/how-to-suppress-and-bypass-system32-file-system-redirect-to-syswow64-folder-with-sysnative/"),t("OutboundLink")],1),e._v(" - How to Suppress and Bypass System32 File System Redirect to SysWOW64 Folder with Sysnative")])]),e._v(" "),t("li",[t("p",[e._v("什么是重定向")])])]),e._v(" "),t("p",[e._v("无论是 Windows XP Professional X64 Edition、Windows Server 2003 X64 Edition 还是 Windows Vista X64 Edition（以下把均统称为 X64 系统），都引入了一项技术：文件和注册表的重定向。")]),e._v(" "),t("p",[e._v("之所以有这个技术，是为了将 32 位程序和 64 位程序分离开。这种在 64 位平台上运行 32 位程序的模拟器被称为 WOW64。WOW64 是 "),t("code",[e._v("Windows 32 on Windows 64")]),e._v(" 的简称，它在系统层中另提供了一层，以支持老式的 32 位程序。")]),e._v(" "),t("p",[e._v("在 X64 系统里面，一些特殊的目录和特殊的注册表键被分为 2 个独立的部分。对于文件系统来说，"),t("code",[e._v("%systemroot%/system32")]),e._v(" 目录被保留给 64 位文件使用，而 32 位文件会被重定向到 "),t("code",[e._v("%systemroot%/SysWOW64")]),e._v(" 目录。换句话说，所有的 32 位程序一般情况下只会出现在 "),t("code",[e._v("%systemroot%/SysWOW64")]),e._v(" 目录里面。任何 32 位程序试图访问 "),t("code",[e._v("%systemroot%/system32")]),e._v(" 目录的企图都会被重定向到 "),t("code",[e._v("%systemroot%/SysWOW64")]),e._v(" 目录。这个是一个默认的行为，除非程序的线程明确的指名需要关闭这种重定向机制。")]),e._v(" "),t("p",[e._v("对于注册表来说，也有类似的内容。WOW64 子系统也提供了对注册表访问的重定向。如果是 32 位程序，对注册表的操作不论是读还是写，WOW64 都将会截取对"),t("code",[e._v("HKLM/Software")]),e._v(" 访问，并重定向到 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v("（即 32 位应用程序的注册信息被写在 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v(" 中，而不是预期的 "),t("code",[e._v("HKLM/Software")]),e._v(" 中）；如果是 64 位程序，就直接到 "),t("code",[e._v("HKLM/Software")]),e._v("。")]),e._v(" "),t("ul",[t("li",[e._v("需要重定向的注册表项")])]),e._v(" "),t("p",[e._v("注册表重定向，其实质就是维护两套不同的注册表键，一套用于 64 位，一套用于 32 位。受影响的键不只是上面提及的 "),t("code",[e._v("HKLM/Software")]),e._v("，还包括：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("HKEY_CLASSES_ROOT   \nHKEY_CURRENT_USER/Software/Classes   \nHKEY_LOCAL_MACHINE/Software   \nHKEY_USERS/*/Software/Classes   \nHKEY_USERS/*_Classes\n")])])]),t("p",[e._v("其中，64位程序的注册信息存储在上面的健中，32位程序的注册信息重定向存储在下列健中：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("HKEY_CLASSES_ROOT/WOW6432node   \nHKEY_CURRENT_USER/Software/Classes/WOW6432node   \nHKEY_LOCAL_MACHINE/Software/WOW6432node   \nHKEY_USERS/*/Software/Classes/WOW6432node   \nHKEY_USERS/*_Classes/WOW6432node\n")])])]),t("p",[e._v("当运行 32 位程序，wow64 会截取程序对注册表 "),t("code",[e._v("HKLM/Software")]),e._v(" 的访问，并重定向于 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v("。")]),e._v(" "),t("p",[e._v("如前面所述，以上这些键会被维护 2 套，但是这2套键是如何维护的呢？其维护的方法是采用一种被称为注册表反射的机制完成的。")]),e._v(" "),t("ul",[t("li",[e._v("注册表反射")])]),e._v(" "),t("p",[e._v("注册表反射是在 64 位注册表视图和 32 位注册表视图之间复制某些特定的注册表项和项值。")]),e._v(" "),t("p",[e._v("如在 X64 系统中，我们在安装 64 位 "),t("code",[e._v("Microsoft Office")]),e._v(" 后，64 位的 "),t("code",[e._v("Winword.exe")]),e._v(" 将注册 "),t("code",[e._v(".doc")]),e._v(" 这个扩展名并把这个扩展名关联到 "),t("code",[e._v("Winword.exe")]),e._v(" 程序，根据 X64 的运行机制，64 位程序修改的是 64 位的注册表键值，但是 WOW64 会自动的把这个修改会同步到 32 位的注册表键下面，这样 32 位和 64 位的应用程序都可以使用 64 位 "),t("code",[e._v("Winword.exe")]),e._v(" 打开 "),t("code",[e._v(".doc")]),e._v(" 文件。")]),e._v(" "),t("p",[e._v("但是，并不是所有的键值都会受到注册表反射机制的影响。实验证明，如果我们使用 32 位的注册表编辑器在 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software")]),e._v(" 下新建一个项，然后使用 64 位的注册表编辑器查看，会发现这个项只会出现在 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software/Wow6432Node")]),e._v(" 键下而不会出现在 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software")]),e._v(" 键下，因为 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software")]),e._v(" 键是专门用于存放 64 位程序所使用的注册表数据的，而 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software/Wow6432Node")]),e._v(" 键是专门用于存放 32 位程序所使用的注册表数据的")]),e._v(" "),t("p",[e._v("注册表中受到反射机制影响的有：")]),e._v(" "),t("p",[t("code",[e._v("HKEY_LOCAL_MACHINE/Software/Classes")]),e._v("（32 位 XP 下读写 "),t("code",[e._v("HKEY_CLASSES_ROOT/Rising.Rav.20")]),e._v(" 会同时出现 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software/Classe/Rising.Rav.20")]),e._v("，两者的值永远相同，似乎有一个是镜像，64 位 XP 下读写 "),t("code",[e._v("HKEY_CLASSES_ROOT/Rising.Rav.20")]),e._v(" 则会被重定向到 "),t("code",[e._v("HKEY_LOCAL_MACHINE/Software/Classe/Rising.Rav.20")]),e._v("，并且由于注册表反射的原因，同时也会修改 "),t("code",[e._v("HKEY_LOCAL_MACHINE/SOFTWARE/Wow6432Node/Classes/Rising.Rav.20")]),e._v("，两者的值同样是永远相同的。）")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("HKEY_LOCAL_MACHINE/Software/COM3  \nHKEY_LOCAL_MACHINE/Software/EventSystem  \nHKEY_LOCAL_MACHINE/Software/Ole  \nHKEY_LOCAL_MACHINE/Software/Rpc  \nHKEY_USERS/*/Software/Classes  \nHKEY_USERS/*_Classes\n")])])]),t("ul",[t("li",[e._v("注册表重定向机制对系统的影响")])]),e._v(" "),t("p",[e._v("由于注册表重定向机制存在，下列程序调用没有问题：")]),e._v(" "),t("p",[e._v("32 位应用程序 a 调用 32 位应用程序 b 并访问 b 的注册表信息。由于注册表重定向机制，32 位应用程序 b 的注册信息在 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v(" 中，而 32 位应用程序 a 访问注册表也会被重定向到 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v(" 中，所以访问正常；")]),e._v(" "),t("p",[e._v("64 位应用程序 a 调用 64 位应用程序 b 并访问 b 的注册表信息。64 位应用程序 b 的注册信息在 "),t("code",[e._v("HKLM/Software")]),e._v("，64 位应用程序 a 访问注册表时直接访问 "),t("code",[e._v("HKLM/Software")]),e._v("，所以访问正常；")]),e._v(" "),t("p",[e._v("但是在下列情况时会出现问题：")]),e._v(" "),t("p",[e._v("64 位应用程序调用 32 位应用程序并访问其注册表信息。")]),e._v(" "),t("p",[e._v("如瑞星杀软有 U 盘病毒查杀功能，在插入 U 盘后弹出的提示框中有瑞星杀毒的标志；但是在 64 位系统中，此项功能失效。这是因为 32 位瑞星将此项功能的注册信息写到了 "),t("code",[e._v("HKLM/Software/Wow6432Node")]),e._v(" 下；而调用该功能的应用程序是 64 位的操作系统，由于 64 位操作系统访问注册表时直接访问 "),t("code",[e._v("HKLM/Software")]),e._v("，所以没有读取到该功能的注册数据，该功能因而失效。")]),e._v(" "),t("p",[e._v("解决方法：在此功能写注册表时，32 位瑞星应用程序要将该注册信息写到 64 位程序的注册表项中，即 "),t("code",[e._v("HKLM/Software")]),e._v(" 下。")]),e._v(" "),t("p",[e._v("32 位应用程序调用 64 位应用程序并访问其注册表信息。解决方法可以参上。")]),e._v(" "),t("ul",[t("li",[e._v("应用程序如何访问注册表")])]),e._v(" "),t("p",[e._v("上文提到 32 位与 64 位应用程序分别访问注册表问题，下面总结一下：")]),e._v(" "),t("ul",[t("li",[e._v("64 位程序如何访问 64 位的注册表 "),t("code",[e._v("HKLM/Software")])]),e._v(" "),t("li",[e._v("64 位程序访问 64 位的注册表，直接到 "),t("code",[e._v("HKLM/Software")]),e._v("。")]),e._v(" "),t("li",[e._v("32 位程序如何访问32位的注册表 "),t("code",[e._v("HKLM/Software/Wow6432Node")])]),e._v(" "),t("li",[e._v("32 位程序访问 32 位的注册表， WOW64 将会截取对 "),t("code",[e._v("HKLM/Software")]),e._v(" 访问，并重定向到 "),t("code",[e._v("HKLM/Software/Wow6432Node")])])])])}),[],!1,null,null,null);_.default=v.exports}}]);