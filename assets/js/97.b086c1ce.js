(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{473:function(a,s,t){"use strict";t.r(s);var n=t(8),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"tou-guo-docker-kuai-su-jian-li-openvpn-si-fu-qi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tou-guo-docker-kuai-su-jian-li-openvpn-si-fu-qi"}},[a._v("#")]),a._v(" 透過 Docker 快速建立 openvpn 伺服器")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("本文章使用 DigitalOcean Ubuntu 16.04 x64 作為範例。")])]),a._v(" "),t("p",[a._v("自從最近中華電信 499 之亂以後，家裡中華電信的光世代寬頻要連線到某些國外的網站 (BoardGameArena, 天命 2) 就非常地不穩定，於是我一時興起，自己架設了一個基於 OpenVPN 協定的 VPN 來使用，網路真的是穩定很多。")]),a._v(" "),t("p",[a._v("這次我選用的是在 Docker Hub 上面的 "),t("code",[a._v("kylemanna/openvpn")]),a._v(" 這個 image，該 "),t("a",{attrs:{href:"https://github.com/kylemanna/docker-openvpn/blob/master/docs/docker-compose.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("image 的原始英文教學在此"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"an-zhuang"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#an-zhuang"}},[a._v("#")]),a._v(" 安裝")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安裝 docker")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -sSL get.docker.com "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 將目前使用者新增到 docker 群組內，需要重新登入才會生效")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$USER")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安裝 docker-compose")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -L "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/docker/compose/releases/download/'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -sL https://api.github.com/repos/docker/compose/releases/latest "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" tag_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cut")]),a._v(" -d"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'\"'")]),a._v(" -f "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("/docker-compose-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" -o /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n")])])]),t("h2",{attrs:{id:"she-ding-docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#she-ding-docker-compose"}},[a._v("#")]),a._v(" 設定 docker-compose")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" ~/ovpn\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" ~/ovpn\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nano")]),a._v(" docker-compose.yml "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# or vim")]),a._v("\n")])])]),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2'")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ovpn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kylemanna/openvpn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/openvpn\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'1194:1194/udp'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cap_add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" NET_ADMIN\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n")])])]),t("h2",{attrs:{id:"quick-start"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#quick-start"}},[a._v("#")]),a._v(" Quick Start")]),a._v(" "),t("p",[a._v("該 "),t("a",{attrs:{href:"https://hub.docker.com/r/kylemanna/openvpn/",target:"_blank",rel:"noopener noreferrer"}},[a._v("image 的 Readme 檔案連結在此"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 請把後面的 udp 改成自己的網址")]),a._v("\ndocker-compose run --rm ovpn ovpn_genconfig -u udp://open.taichunmin.idv.tw\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 需要輸入密碼以及一些設定值")]),a._v("\ndocker-compose run --rm ovpn ovpn_initpki\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 啟動 ovpn 伺服器")]),a._v("\ndocker-compose up -d\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 請將這個變數的內容改成自己想要的")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CLIENTNAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"taichunmin"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 建立一個 client 的憑證 (不須密碼)")]),a._v("\ndocker-compose run --rm ovpn easyrsa build-client-full "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CLIENTNAME")]),a._v('"')]),a._v(" nopass\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 將 client 的憑證匯出")]),a._v("\ndocker-compose run --rm ovpn ovpn_getclient "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CLIENTNAME")]),a._v('"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CLIENTNAME")]),a._v('.ovpn"')]),a._v("\n")])])]),t("h2",{attrs:{id:"xia-zai-taichunmin.ovpn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#xia-zai-taichunmin.ovpn"}},[a._v("#")]),a._v(" 下載 "),t("code",[a._v("taichunmin.ovpn")])]),a._v(" "),t("ul",[t("li",[a._v("Windows 放於: "),t("code",[a._v("C:\\Users\\taich\\OpenVPN\\config")])])]),a._v(" "),t("h2",{attrs:{id:"zai-client-an-zhuang-openvpn-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zai-client-an-zhuang-openvpn-client"}},[a._v("#")]),a._v(" 在 client 安裝 OpenVPN Client")]),a._v(" "),t("p",[a._v("這裡都是按照"),t("a",{attrs:{href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04",target:"_blank",rel:"noopener noreferrer"}},[a._v("這篇 DigitalOcean 上的教學文章"),t("OutboundLink")],1),a._v("來安裝的。")]),a._v(" "),t("h3",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[a._v("#")]),a._v(" Windows")]),a._v(" "),t("p",[a._v("於 "),t("a",{attrs:{href:"https://openvpn.net/index.php/open-source/downloads.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("下載頁面"),t("OutboundLink")],1),a._v(" 下載安裝檔即可。")])])}),[],!1,null,null,null);s.default=e.exports}}]);